# SWE-Factory ä»£ç åº“å·¥ä½œæµè¯¦ç»†åˆ†æ

## 1. é¡¹ç›®æ¦‚è¿°

SWE-Factory æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ GitHub Issue è§£å†³æ–¹æ¡ˆè®­ç»ƒæ•°æ®å’Œè¯„ä¼°åŸºå‡†ç”Ÿæˆå·¥å‚ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

1. **è‡ªåŠ¨æ”¶é›†** GitHub ä¸Šçš„åŸå§‹ Issue æ•°æ®
2. **è‡ªåŠ¨æ„å»º** å¯å¤ç°çš„ Docker è¯„ä¼°ç¯å¢ƒ
3. **è‡ªåŠ¨éªŒè¯** Fail2Passï¼ˆæµ‹è¯•ä»å¤±è´¥åˆ°é€šè¿‡ï¼‰çš„æœ‰æ•ˆæ€§

è¯¥é¡¹ç›®åŸºäº LLM é©±åŠ¨çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ **SWE-Builder**ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åœ°ä¸º GitHub Issue åˆ›å»ºè¯„ä¼°ç¯å¢ƒã€‚

---

## 2. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SWE-Factory å·¥ä½œæµ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Stage I       â”‚    â”‚   Stage II      â”‚    â”‚   Stage III     â”‚         â”‚
â”‚  â”‚ æ•°æ®æ”¶é›†        â”‚ -> â”‚ ç¯å¢ƒè‡ªåŠ¨æ„å»º    â”‚ -> â”‚ Fail2Pass éªŒè¯  â”‚         â”‚
â”‚  â”‚ (data_collection)â”‚   â”‚ (app/agents)    â”‚    â”‚ (evaluation)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Stage I: åŸå§‹ Issue æ•°æ®æ”¶é›†

### 3.1 ç›®å½•ç»“æ„
```
data_collection/
â”œâ”€â”€ collect/
â”‚   â”œâ”€â”€ get_top_repos.py      # è·å–çƒ­é—¨ä»“åº“
â”‚   â”œâ”€â”€ print_pulls.py        # æ”¶é›† PR æ•°æ®
â”‚   â”œâ”€â”€ build_dataset.py      # æ„å»ºä»»åŠ¡å®ä¾‹
â”‚   â”œâ”€â”€ get_version.py        # ç‰ˆæœ¬æ ‡æ³¨
â”‚   â””â”€â”€ utils.py              # å·¥å…·å‡½æ•°
â””â”€â”€ versioning/               # ç‰ˆæœ¬ç®¡ç†
```

### 3.2 æ•°æ®æ”¶é›†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è·å–çƒ­é—¨ä»“åº“   â”‚ --> â”‚ 2. æ”¶é›† PR æ•°æ®   â”‚ --> â”‚ 3. æ„å»ºä»»åŠ¡å®ä¾‹   â”‚ --> â”‚ 4. ç‰ˆæœ¬æ ‡æ³¨       â”‚
â”‚ get_top_repos.py â”‚     â”‚ print_pulls.py   â”‚     â”‚ build_dataset.py â”‚     â”‚ get_version.py   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 1: è·å–çƒ­é—¨ä»“åº“
```bash
python get_top_repos.py --language Python --output_path data/popular_repos --top_n 100
```
- ä½¿ç”¨ GitHub API æŒ‰æ˜Ÿæ ‡æ•°è·å–æŒ‡å®šè¯­è¨€çš„çƒ­é—¨ä»“åº“
- è¾“å‡º: `python_top_100_repos.json`

#### Step 2: æ”¶é›† PR æ•°æ®
```bash
python print_pulls.py python-attrs/attrs data/python-attrs/attrs/prs.jsonl
```
- ä»æŒ‡å®šä»“åº“æ”¶é›†æ‰€æœ‰ Pull Request æ•°æ®
- è¾“å‡º: JSONL æ ¼å¼çš„ PR æ•°æ®æ–‡ä»¶

#### Step 3: æ„å»ºä»»åŠ¡å®ä¾‹
```bash
python build_dataset.py data/prs.jsonl data/instances.jsonl --language python
```
æ ¸å¿ƒé€»è¾‘ (`build_dataset.py`):
- **éªŒè¯ PR æœ‰æ•ˆæ€§**: æ£€æŸ¥ PR æ˜¯å¦å·²åˆå¹¶ã€æ˜¯å¦å…³è” Issue
- **æå– Patch**: ä» PR ä¸­æå–ä»£ç è¡¥ä¸å’Œæµ‹è¯•è¡¥ä¸
- **æå–é—®é¢˜æè¿°**: ä»å…³è”çš„ Issue ä¸­æå–é—®é¢˜é™ˆè¿°

è¾“å‡ºçš„ä»»åŠ¡å®ä¾‹ç»“æ„:
```json
{
    "repo": "owner/repo",
    "pull_number": 123,
    "instance_id": "owner__repo-123",
    "base_commit": "abc123...",
    "patch": "diff --git ...",
    "test_patch": "diff --git ...",
    "problem_statement": "Issue description...",
    "created_at": "2024-01-01T00:00:00Z"
}
```

#### Step 4: ç‰ˆæœ¬æ ‡æ³¨
```bash
python get_version.py --instance_path instances.jsonl --testbed github --max-workers 20
```
- é€šè¿‡ `git describe --tags` ä¸ºæ¯ä¸ªå®ä¾‹åˆ†é…ç‰ˆæœ¬å·

---

## 4. Stage II: è‡ªåŠ¨åŒ–è¯„ä¼°ç¯å¢ƒæ„å»º (SWE-Builder)

### 4.1 æ ¸å¿ƒæ¶æ„

SWE-Builder æ˜¯ä¸€ä¸ª LLM é©±åŠ¨çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SWE-Builder å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚   AgentsManager     â”‚  <-- æ ¸å¿ƒè°ƒåº¦å™¨                                     â”‚
â”‚  â”‚   (agents_manager.py)â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚             â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚          â”‚                                                       â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚  â”‚  â”‚ Context       â”‚  â”‚ Write Dockerfileâ”‚  â”‚ Write EvalScriptâ”‚    â”‚       â”‚
â”‚  â”‚  â”‚ Retrieval     â”‚  â”‚ Agent           â”‚  â”‚ Agent           â”‚    â”‚       â”‚
â”‚  â”‚  â”‚ Agent         â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚       â”‚
â”‚  â”‚  â”‚ (ğŸ” æ¢ç´¢è€…)    â”‚  â”‚ (ğŸ³ ç¯å¢ƒç®¡ç†å™¨) â”‚  â”‚ (ğŸ“ æµ‹è¯•ç®¡ç†å™¨) â”‚    â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  â”‚ Test Analysis   â”‚  â”‚ Evaluation Environment Memory Pool  â”‚   â”‚       â”‚
â”‚  â”‚  â”‚ Agent           â”‚  â”‚ (ğŸ’¾ è¯„ä¼°ç¯å¢ƒè®°å¿†æ± )                  â”‚   â”‚       â”‚
â”‚  â”‚  â”‚ (ğŸ”¬ æµ‹è¯•åˆ†æå¸ˆ) â”‚  â”‚                                     â”‚   â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…¥å£ç‚¹ä¸å‘½ä»¤è¡Œæ¥å£

**ä¸»å…¥å£**: `app/main.py`

```bash
python app/main.py swe-bench \
    --model gpt-4.1-mini \
    --tasks-map "python-mypy-instances.jsonl" \
    --num-processes 10 \
    --model-temperature 0.2 \
    --conv-round-limit 10 \
    --output-dir "output/mypy" \
    --setup-dir "testbed" \
    --results-path "output/mypy/results"
```

æ”¯æŒçš„å­å‘½ä»¤:
- `swe-bench`: è¿è¡Œ SWE-bench æ ¼å¼çš„ä»»åŠ¡
- `github-issue`: è¿è¡Œåœ¨çº¿ GitHub Issue
- `local-issue`: è¿è¡Œæœ¬åœ° Issue

### 4.3 ä»»åŠ¡æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä»»åŠ¡æ‰§è¡Œæµç¨‹                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  main.py                                                                    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ 1. è§£æå‘½ä»¤è¡Œå‚æ•°                                                    â”‚
â”‚     â”œâ”€â”€ 2. åŠ è½½ä»»åŠ¡æ˜ å°„æ–‡ä»¶ (tasks_map)                                      â”‚
â”‚     â”œâ”€â”€ 3. åˆ›å»º RawSweTask åˆ—è¡¨                                             â”‚
â”‚     â”œâ”€â”€ 4. æŒ‰ç¯å¢ƒåˆ†ç»„ä»»åŠ¡                                                    â”‚
â”‚     â””â”€â”€ 5. å¹¶è¡Œ/ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ç»„                                               â”‚
â”‚            â”‚                                                                â”‚
â”‚            â–¼                                                                â”‚
â”‚     run_task_groups()                                                       â”‚
â”‚            â”‚                                                                â”‚
â”‚            â”œâ”€â”€ å•è¿›ç¨‹æ¨¡å¼: run_tasks_serial()                               â”‚
â”‚            â””â”€â”€ å¤šè¿›ç¨‹æ¨¡å¼: run_task_groups_parallel()                       â”‚
â”‚                   â”‚                                                         â”‚
â”‚                   â–¼                                                         â”‚
â”‚            run_task_in_subprocess()  [å¸¦è¶…æ—¶æ§åˆ¶, é»˜è®¤ 5400s]               â”‚
â”‚                   â”‚                                                         â”‚
â”‚                   â–¼                                                         â”‚
â”‚            run_raw_task()                                                   â”‚
â”‚                   â”‚                                                         â”‚
â”‚                   â”œâ”€â”€ åˆ›å»ºè¾“å‡ºç›®å½•                                           â”‚
â”‚                   â”œâ”€â”€ æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ (status.json)                           â”‚
â”‚                   â””â”€â”€ do_inference()                                        â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚                   AgentsManager.run_workflow()                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 AgentsManager å·¥ä½œæµ

`AgentsManager` æ˜¯æ•´ä¸ªå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„æ ¸å¿ƒè°ƒåº¦å™¨ï¼Œä½äº `app/agents/agents_manager.py`ã€‚

#### åˆå§‹åŒ–é˜¶æ®µ
```python
agents_dict = {
    "write_docker_agent": WriteDockerfileAgent(...),
    "write_eval_script_agent": WriteEvalScriptAgent(...),
    "test_analysis_agent": TestAnalysisAgent(...),
    "context_retrieval_agent": ContextRetrievalAgent(...),
}
```

#### è¿­ä»£å·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AgentsManager.run_workflow() è¿­ä»£æµç¨‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  for iteration in range(max_iteration_num):                                 â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ 1. Context Retrieval Agent (ä¸Šä¸‹æ–‡æ£€ç´¢)                            â”‚
â”‚      â”‚      â””â”€â”€ æ”¶é›†ä»“åº“ç¯å¢ƒä¿¡æ¯ã€READMEã€é…ç½®æ–‡ä»¶ç­‰                          â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ 2. æ£€æŸ¥ Memory Pool (è®°å¿†æ± )                                       â”‚
â”‚      â”‚      â””â”€â”€ æŸ¥æ‰¾åŒä»“åº“å†å²æˆåŠŸé…ç½®ä½œä¸ºå‚è€ƒ                                â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ 3. Write Dockerfile Agent (Dockerfile ç”Ÿæˆ)                        â”‚
â”‚      â”‚      â””â”€â”€ åŸºäºæ”¶é›†çš„ä¿¡æ¯ç”Ÿæˆ Dockerfile                                â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ 4. Write Eval Script Agent (è¯„ä¼°è„šæœ¬ç”Ÿæˆ)                          â”‚
â”‚      â”‚      â””â”€â”€ ç”Ÿæˆæµ‹è¯•æ‰§è¡Œè„šæœ¬ eval.sh                                     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â”€ 5. Test Analysis Agent (æµ‹è¯•åˆ†æ)                                  â”‚
â”‚             â”‚                                                               â”‚
â”‚             â”œâ”€â”€ æ„å»º Docker é•œåƒ                                            â”‚
â”‚             â”œâ”€â”€ è¿è¡Œæµ‹è¯•                                                    â”‚
â”‚             â”œâ”€â”€ åˆ†ææµ‹è¯•æ—¥å¿—                                                â”‚
â”‚             â”‚                                                               â”‚
â”‚             â””â”€â”€ æ ¹æ®åˆ†æç»“æœå†³å®šä¸‹ä¸€æ­¥:                                      â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â”œâ”€â”€ is_finish=True  â†’ æˆåŠŸï¼Œé€€å‡ºå¾ªç¯                     â”‚
â”‚                    â”œâ”€â”€ guidance_for_context_retrieval_agent â†’ é‡æ–°æ”¶é›†ä¿¡æ¯  â”‚
â”‚                    â”œâ”€â”€ guidance_for_write_dockerfile_agent â†’ ä¿®æ”¹Dockerfile â”‚
â”‚                    â””â”€â”€ guidance_for_write_eval_script_agent â†’ ä¿®æ”¹è¯„ä¼°è„šæœ¬  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 å„ Agent è¯¦ç»†è¯´æ˜

#### 4.5.1 Context Retrieval Agent (ä¸Šä¸‹æ–‡æ£€ç´¢æ™ºèƒ½ä½“)

**æ–‡ä»¶**: `app/agents/context_retrieval_agent/context_retrieval_agent.py`

**èŒè´£**: è‡ªåŠ¨æ¢ç´¢ä»“åº“ç»“æ„ï¼Œæ”¶é›†ç¯å¢ƒé…ç½®ä¿¡æ¯

**API å‡½æ•°**:
- `browse_folder(path, depth)`: æµè§ˆæ–‡ä»¶å¤¹ç»“æ„
- `search_files_by_keyword(keyword)`: æŒ‰å…³é”®è¯æœç´¢æ–‡ä»¶
- `browse_file_for_environment_info(file_path, custom_query)`: æå–ç¯å¢ƒé…ç½®ä¿¡æ¯

**å·¥ä½œæµç¨‹**:
```
1. åˆå§‹åŒ–: è·å–ä»“åº“æ ¹ç›®å½•ç»“æ„
2. å¾ªç¯:
   a. LLM ç”Ÿæˆ API è°ƒç”¨è®¡åˆ’
   b. æ‰§è¡Œ API è°ƒç”¨ï¼Œæ”¶é›†ä¿¡æ¯
   c. åˆ†ææ”¶é›†çš„ä¿¡æ¯
   d. åˆ¤æ–­æ˜¯å¦è¶³å¤Ÿï¼Œä¸è¶³åˆ™ç»§ç»­æ”¶é›†
3. è¾“å‡º: æ±‡æ€»çš„ç¯å¢ƒé…ç½®ä¿¡æ¯
```

#### 4.5.2 Write Dockerfile Agent (Dockerfile ç”Ÿæˆæ™ºèƒ½ä½“)

**æ–‡ä»¶**: `app/agents/write_dockerfile_agent/write_dockerfile_agent.py`

**èŒè´£**: ç”Ÿæˆå¯å¤ç°çš„ Docker ç¯å¢ƒé…ç½®

**ç‰¹æ€§**:
- æ”¯æŒå‚è€ƒå†å²æˆåŠŸé…ç½® (Memory Pool)
- æ”¯æŒè¿­ä»£ä¿®æ”¹ Dockerfile
- æ”¯æŒä»…ä½¿ç”¨ Ubuntu åŸºç¡€é•œåƒæ¨¡å¼

**è¾“å‡º**: `Dockerfile`

#### 4.5.3 Write Eval Script Agent (è¯„ä¼°è„šæœ¬ç”Ÿæˆæ™ºèƒ½ä½“)

**æ–‡ä»¶**: `app/agents/write_eval_script_agent/write_eval_script_agent.py`

**èŒè´£**: ç”Ÿæˆæµ‹è¯•æ‰§è¡Œè„šæœ¬

**æ ¸å¿ƒåŠŸèƒ½**:
- ç”Ÿæˆ `eval.sh` è„šæœ¬
- å¤„ç†æµ‹è¯•è¡¥ä¸çš„åº”ç”¨
- å¤„ç†äºŒè¿›åˆ¶æµ‹è¯•èµ„æºçš„ä¸‹è½½

**è„šæœ¬éª¨æ¶ç»“æ„**:
```bash
#!/bin/bash
set -uxo pipefail
cd /testbed
git checkout <commit> <test_files>
# ä¸‹è½½æµ‹è¯•èµ„æº (å¦‚æœ‰)
git apply -v - <<'EOF_114329324912'
[TEST PATCH CONTENT]
EOF_114329324912
# è¿è¡Œæµ‹è¯•å‘½ä»¤
<test_command>
git checkout <commit> <test_files>  # æ¢å¤æµ‹è¯•æ–‡ä»¶
```

#### 4.5.4 Test Analysis Agent (æµ‹è¯•åˆ†ææ™ºèƒ½ä½“)

**æ–‡ä»¶**: `app/agents/test_analysis_agent/test_analysis_agent.py`

**èŒè´£**: æ„å»ºé•œåƒã€è¿è¡Œæµ‹è¯•ã€åˆ†æç»“æœ

**æ ¸å¿ƒåŠŸèƒ½**:

1. **Docker é•œåƒæ„å»º** (`build_docker_image`):
   - ä½¿ç”¨ç”Ÿæˆçš„ Dockerfile æ„å»ºé•œåƒ
   - è¯¦ç»†è®°å½•æ„å»ºæ—¥å¿—
   - æ•è·æ„å»ºé”™è¯¯

2. **æµ‹è¯•æ‰§è¡Œ** (`run_test`):
   - å¯åŠ¨å®¹å™¨
   - åº”ç”¨ä»£ç è¡¥ä¸
   - æ‰§è¡Œè¯„ä¼°è„šæœ¬
   - æ”¶é›†æµ‹è¯•è¾“å‡º

3. **ç»“æœåˆ†æ**:
   - åˆ†ææµ‹è¯•æ—¥å¿—
   - åˆ¤æ–­æ˜¯å¦æˆåŠŸ
   - ç”Ÿæˆä¿®æ”¹å»ºè®®

**è¾“å‡ºå†³ç­–**:
```json
{
    "is_finish": true/false,
    "guidance_for_context_retrieval_agent": "...",
    "guidance_for_write_dockerfile_agent": "...",
    "guidance_for_write_eval_script_agent": "..."
}
```

### 4.6 Memory Pool (è¯„ä¼°ç¯å¢ƒè®°å¿†æ± )

**åŠŸèƒ½**: å¤ç”¨å†å²æˆåŠŸé…ç½®ï¼Œæé«˜æ•ˆç‡å’Œä¸€è‡´æ€§

**å®ç°**:
- å­˜å‚¨åœ¨ `results.json` æ–‡ä»¶ä¸­
- æŒ‰ä»“åº“åå’Œç‰ˆæœ¬å·ç´¢å¼•
- ä½¿ç”¨æ–‡ä»¶é”ä¿è¯å¹¶å‘å®‰å…¨

**æŸ¥æ‰¾é€»è¾‘** (`get_closest_version_info`):
1. ç­›é€‰åŒä»“åº“çš„å†å²è®°å½•
2. ç²¾ç¡®åŒ¹é…ç‰ˆæœ¬å·
3. å¦‚æ— ç²¾ç¡®åŒ¹é…ï¼Œé€‰æ‹©æœ€æ¥è¿‘çš„è¾ƒä½ç‰ˆæœ¬

---

## 5. Stage III: Fail2Pass éªŒè¯

### 5.1 ç›®å½•ç»“æ„
```
evaluation/
â”œâ”€â”€ run_evaluation.py    # ä¸»è¯„ä¼°è„šæœ¬
â”œâ”€â”€ docker_build.py      # Docker æ„å»ºå·¥å…·
â”œâ”€â”€ docker_utils.py      # Docker å·¥å…·å‡½æ•°
â”œâ”€â”€ test_spec.py         # æµ‹è¯•è§„æ ¼å®šä¹‰
â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°

scripts/
â”œâ”€â”€ judge_fail2pass.py   # Fail2Pass åˆ¤æ–­è„šæœ¬
â””â”€â”€ compute_cost.py      # æˆæœ¬è®¡ç®—è„šæœ¬
```

### 5.2 Fail2Pass éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Fail2Pass éªŒè¯æµç¨‹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. ç”Ÿæˆæµ‹è¯•æ—¥å¿—                                                             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ run_evaluation.py --is_judge_fail2pass                             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ å¯¹æ¯ä¸ªå®ä¾‹:                                                         â”‚
â”‚     â”‚   â”œâ”€â”€ æ„å»º Docker é•œåƒ                                                â”‚
â”‚     â”‚   â”œâ”€â”€ è¿è¡Œæµ‹è¯• (ä¸åº”ç”¨è¡¥ä¸) â†’ test_output_prev_apply.txt             â”‚
â”‚     â”‚   â””â”€â”€ è¿è¡Œæµ‹è¯• (åº”ç”¨è¡¥ä¸)   â†’ test_output_after_apply.txt            â”‚
â”‚     â”‚                                                                       â”‚
â”‚  2. åˆ¤æ–­ Fail2Pass çŠ¶æ€                                                     â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ judge_fail2pass.py                                                 â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€ åˆ†ç±»ç»“æœ:                                                           â”‚
â”‚         â”œâ”€â”€ fail2pass: è¡¥ä¸å‰å¤±è´¥ï¼Œè¡¥ä¸åé€šè¿‡ âœ“                             â”‚
â”‚         â”œâ”€â”€ fail2fail: è¡¥ä¸å‰åéƒ½å¤±è´¥                                       â”‚
â”‚         â”œâ”€â”€ pass2pass: è¡¥ä¸å‰åéƒ½é€šè¿‡                                       â”‚
â”‚         â”œâ”€â”€ pass2fail: è¡¥ä¸å‰é€šè¿‡ï¼Œè¡¥ä¸åå¤±è´¥                               â”‚
â”‚         â””â”€â”€ error: æ— æ³•åˆ¤æ–­                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 éªŒè¯å‘½ä»¤

```bash
# Step 1: ç”Ÿæˆæµ‹è¯•æ—¥å¿—
python run_evaluation.py \
  --dataset_name "output/mypy/results/results.json" \
  --predictions_path "gold" \
  --max_workers 5 \
  --run_id "mypy_fail2pass_check" \
  --output_path "run_instances" \
  --timeout 3600 \
  --is_judge_fail2pass

# Step 2: åˆ¤æ–­ Fail2Pass çŠ¶æ€
python scripts/judge_fail2pass.py \
  evaluation/run_instance/mypy_gpt-4.1-mini/gold \
  fail2pass_status.json
```

### 5.4 é€€å‡ºç åˆ¤æ–­é€»è¾‘

```python
# ä»æµ‹è¯•è¾“å‡ºä¸­æå–é€€å‡ºç 
EXIT_CODE_RE = re.compile(r"echo OMNIGRIL_EXIT_CODE=(\d+)")

# åˆ¤æ–­é€»è¾‘
prev_fail = (prev_exit != 0)   # è¡¥ä¸å‰æ˜¯å¦å¤±è´¥
after_pass = (after_exit == 0)  # è¡¥ä¸åæ˜¯å¦é€šè¿‡

if prev_fail and after_pass:
    return "fail2pass"  # æœ‰æ•ˆå®ä¾‹
```

---

## 6. æ•°æ®æµä¸æ–‡ä»¶ç»“æ„

### 6.1 è¾“å…¥æ•°æ®æ ¼å¼

**ä»»åŠ¡å®ä¾‹ (JSONL)**:
```json
{
    "instance_id": "owner__repo-123",
    "repo": "owner/repo",
    "pull_number": 123,
    "base_commit": "abc123...",
    "patch": "diff --git a/file.py b/file.py\n...",
    "test_patch": "diff --git a/test_file.py b/test_file.py\n...",
    "problem_statement": "Issue description...",
    "version": "1.0.0"
}
```

### 6.2 è¾“å‡ºç›®å½•ç»“æ„

```
output/
â”œâ”€â”€ <instance_id>/
â”‚   â”œâ”€â”€ meta.json                    # ä»»åŠ¡å…ƒæ•°æ®
â”‚   â”œâ”€â”€ problem_statement.txt        # é—®é¢˜æè¿°
â”‚   â”œâ”€â”€ developer_patch.diff         # å¼€å‘è€…è¡¥ä¸
â”‚   â”œâ”€â”€ cost.json                    # æ‰§è¡Œæˆæœ¬ç»Ÿè®¡
â”‚   â”œâ”€â”€ status.json                  # å®ŒæˆçŠ¶æ€
â”‚   â”œâ”€â”€ Dockerfile                   # ç”Ÿæˆçš„ Dockerfile
â”‚   â”œâ”€â”€ eval.sh                      # ç”Ÿæˆçš„è¯„ä¼°è„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ context_retrieval_agent_1/   # ä¸Šä¸‹æ–‡æ£€ç´¢è¾“å‡º
â”‚   â”‚   â”œâ”€â”€ conversation_0.json
â”‚   â”‚   â”œâ”€â”€ agent_proxy_0.json
â”‚   â”‚   â””â”€â”€ tool_sequence.json
â”‚   â”‚
â”‚   â”œâ”€â”€ write_dockerfile_agent_1/    # Dockerfile ç”Ÿæˆè¾“å‡º
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ conversation.json
â”‚   â”‚
â”‚   â”œâ”€â”€ write_eval_script_agent_1/   # è¯„ä¼°è„šæœ¬ç”Ÿæˆè¾“å‡º
â”‚   â”‚   â”œâ”€â”€ eval.sh
â”‚   â”‚   â”œâ”€â”€ eval_skeleton.sh
â”‚   â”‚   â””â”€â”€ conversation.json
â”‚   â”‚
â”‚   â””â”€â”€ test_analysis_agent_1/       # æµ‹è¯•åˆ†æè¾“å‡º
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ eval.sh
â”‚       â”œâ”€â”€ patch.diff
â”‚       â”œâ”€â”€ build_image.log
â”‚       â”œâ”€â”€ run_test.log
â”‚       â”œâ”€â”€ test_output.txt
â”‚       â”œâ”€â”€ analysis.json
â”‚       â””â”€â”€ conversation.json
â”‚
â”œâ”€â”€ applicable_setup/                # æˆåŠŸçš„å®ä¾‹
â”œâ”€â”€ no_setup/                        # å¤±è´¥çš„å®ä¾‹
â”œâ”€â”€ predictions.json                 # æœ€ç»ˆé¢„æµ‹ç»“æœ
â””â”€â”€ raw_predictions.json             # åŸå§‹é¢„æµ‹ç»“æœ
```

### 6.3 ç»“æœæ–‡ä»¶æ ¼å¼

**results.json** (Memory Pool):
```json
[
    {
        "instance_id": "owner__repo-123",
        "repo": "owner/repo",
        "version": "1.0.0",
        "dockerfile": "FROM python:3.9\n...",
        "eval_script": "#!/bin/bash\n...",
        "eval_script_skeleton": "#!/bin/bash\n...",
        "patch": "diff --git ...",
        ...
    }
]
```

---

## 7. å…³é”®é…ç½®å‚æ•°

### 7.1 å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--model` | ä½¿ç”¨çš„ LLM æ¨¡å‹ | gpt-3.5-turbo-0125 |
| `--model-temperature` | æ¨¡å‹æ¸©åº¦ | 0.0 |
| `--conv-round-limit` | æœ€å¤§è¿­ä»£è½®æ•° | 15 |
| `--num-processes` | å¹¶è¡Œè¿›ç¨‹æ•° | 1 |
| `--disable-memory-pool` | ç¦ç”¨è®°å¿†æ±  | False |
| `--disable-run-test` | ç¦ç”¨æµ‹è¯•è¿è¡Œ | False |
| `--disable-context-retrieval` | ç¦ç”¨ä¸Šä¸‹æ–‡æ£€ç´¢ | False |
| `--using-ubuntu-only` | ä»…ä½¿ç”¨ Ubuntu é•œåƒ | False |

### 7.2 è¶…æ—¶è®¾ç½®

- å•ä»»åŠ¡è¶…æ—¶: 5400 ç§’ (90 åˆ†é’Ÿ)
- Docker æ„å»ºè¶…æ—¶: 3600 ç§’ (60 åˆ†é’Ÿ)
- æµ‹è¯•æ‰§è¡Œè¶…æ—¶: 3600 ç§’ (60 åˆ†é’Ÿ)

---

## 8. æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

- Python
- Java
- JavaScript
- TypeScript

---

## 9. æ€§èƒ½æŒ‡æ ‡

æ ¹æ® README ä¸­çš„è¯„ä¼°ç»“æœ:

| åŸºç¡€æ¨¡å‹ | F2P ç‡ | è¾“å‡ºç‡ | æˆæœ¬ (USD) | æ—¶é—´ (åˆ†é’Ÿ) |
|----------|--------|--------|------------|-------------|
| GPT-4.1-mini | 50.2% | 64.8% | 0.047 | 26.3 |
| DeepSeek-v3-0324 | 42.0% | 53.4% | 0.037 | 23.0 |
| Kimi-K2 | 47.8% | 63.2% | 0.056 | 30.2 |

---

## 10. æ‰©å±•ä¸å®šåˆ¶

### 10.1 æ·»åŠ æ–°è¯­è¨€æ”¯æŒ

1. åœ¨ `data_collection/collect/utils.py` ä¸­æ·»åŠ è¯­è¨€ç‰¹å®šçš„æ–‡ä»¶æ¨¡å¼
2. åœ¨ Agent çš„ prompt ä¸­æ·»åŠ è¯­è¨€ç‰¹å®šçš„æŒ‡å¯¼
3. æ›´æ–°æµ‹è¯•å‘½ä»¤è¯†åˆ«é€»è¾‘

### 10.2 è‡ªå®šä¹‰ Agent

ç»§æ‰¿ `Agent` åŸºç±»:
```python
from app.agents.agent import Agent

class CustomAgent(Agent):
    api_functions = ["custom_function"]
    
    def __init__(self, task, output_dir, ...):
        super().__init__(agent_id="CustomAgent")
        ...
    
    def run_task(self, print_callback=None):
        # å®ç°ä»»åŠ¡é€»è¾‘
        return output, summary, success
```

---

## 11. æ€»ç»“

SWE-Factory é€šè¿‡ä¸‰ä¸ªé˜¶æ®µçš„è‡ªåŠ¨åŒ–æµç¨‹ï¼Œå®ç°äº†ä»åŸå§‹ GitHub Issue åˆ°å¯è¯„ä¼°æ•°æ®é›†çš„å®Œæ•´è½¬æ¢ï¼š

1. **æ•°æ®æ”¶é›†**: è‡ªåŠ¨ä» GitHub æ”¶é›† PR å’Œ Issue æ•°æ®
2. **ç¯å¢ƒæ„å»º**: ä½¿ç”¨ LLM å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ Docker ç¯å¢ƒå’Œæµ‹è¯•è„šæœ¬
3. **éªŒè¯**: é€šè¿‡ Fail2Pass éªŒè¯ç¡®ä¿æ•°æ®è´¨é‡

æ ¸å¿ƒåˆ›æ–°ç‚¹:
- **å¤šæ™ºèƒ½ä½“åä½œ**: å››ä¸ªä¸“ä¸šåŒ– Agent åˆ†å·¥åä½œ
- **è¿­ä»£ä¼˜åŒ–**: åŸºäºæµ‹è¯•åé¦ˆè‡ªåŠ¨ä¿®æ­£é…ç½®
- **è®°å¿†æ± å¤ç”¨**: åˆ©ç”¨å†å²æˆåŠŸé…ç½®æé«˜æ•ˆç‡
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒ Pythonã€Javaã€JavaScriptã€TypeScript
